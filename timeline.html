<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>timeline</title>

  <style>
    :root{
      --bg:#fff;
      --text: rgba(0,0,0,0.90);
      --muted: rgba(0,0,0,0.58);
      --rule: rgba(0,0,0,0.10);
    }
    html,body{ margin:0; background:var(--bg); color:var(--text); }
    body{
      font-family: system-ui, -apple-system, "Segoe UI",
                   "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo",
                   "Noto Sans JP", sans-serif;
      letter-spacing: 0.01em;
      line-height: 1.55;
    }
    main{
      max-width: 760px;
      margin-left: auto;
      margin-right: auto;
      padding: 44px 18px 96px;
    }
    h1{ font-size:16px; font-weight:600; margin:0 0 14px; }
    hr{ border:none; border-top:1px solid var(--rule); margin:16px 0 18px; }
    h2{ font-size:13px; font-weight:600; color:var(--muted); margin:22px 0 10px; }
    ul{ margin:0 0 0 1.15em; padding:0; }
    li{ margin:6px 0; }

    .scroll-dummy{ height: 1400px; }

    .fab{
      position:fixed; right:14px; bottom:14px; z-index:9999;
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border:1px solid rgba(0,0,0,0.12);
      border-radius:999px;
      background:rgba(255,255,255,0.92);
      font-size:12.5px;
    }
    .fab button{ border:none; background:none; cursor:pointer; }
    .fab .state{ font-variant-numeric: tabular-nums; }

    .exp{
      position:fixed; top:12px; right:12px; z-index:9999;
      padding:10px 12px;
      border:1px solid rgba(0,0,0,0.12);
      border-radius:12px;
      background:rgba(255,255,255,0.92);
      font-size:12px;
      min-width:190px;
    }
  </style>
</head>

<body>
<main>
  <h1>年表（確認用）</h1>
  <hr>

  <!-- （内容はそのまま） -->
  <h2>前8世紀頃</h2>
  <ul><li>イリアス</li><li>オデュッセイア</li></ul>
  <h2>前7世紀</h2><ul><li>神統記</li></ul>
  <h2>前4世紀</h2><ul><li>ティマイオス</li><li>形而上学</li><li>国家</li></ul>
  <h2>1687</h2><ul><li>プリンキピア</li></ul>
  <h2>1781</h2><ul><li>純粋理性批判</li></ul>
  <h2>1790</h2><ul><li>判断力批判</li></ul>
  <h2>1807</h2><ul><li>精神現象学</li></ul>
  <h2>1812</h2><ul><li>論理学</li></ul>
  <h2>1844</h2><ul><li>経済学・哲学草稿</li></ul>
  <h2>1859</h2><ul><li>種の起源</li></ul>
  <h2>1886</h2><ul><li>善悪の彼岸</li></ul>
  <h2>1900</h2><ul><li>論理哲学論考</li></ul>
  <h2>1927</h2><ul><li>存在と時間</li></ul>
  <h2>1929</h2><ul><li>過程と実在</li></ul>
  <h2>1936</h2><ul><li>芸術作品の複製技術時代</li></ul>
  <h2>1953</h2><ul><li>哲学探究</li></ul>
  <h2>1958</h2><ul><li>物理学と哲学</li></ul>
  <h2>2025</h2><ul><li>原典翻訳プロジェクト</li></ul>
  <h2 id="last">2026</h2>
  <ul>
    <li>物とは何か</li>
    <li>哲学者たちは、物をどう捉えてきたのか</li>
    <li>本_倫理</li>
  </ul>
</main>

<div class="scroll-dummy"></div>

<div class="exp">
  <div>cycle: <span id="cycle">down</span></div>
  <div>state: <span id="runstate">off</span></div>
</div>

<div class="fab">
  <button id="toggle">walk</button>
  <span class="state" id="state">off</span>
</div>

<script>
const toggleBtn = document.getElementById('toggle');
const stateEl = document.getElementById('state');
const runStateEl = document.getElementById('runstate');
const cycleEl = document.getElementById('cycle');
const lastMarker = document.getElementById('last');

const BASE = 1.2;          // 下へゆっくり
const REWIND_MULT = 3;     // ★ 巻き戻し 3倍速
const EDGE = 20;

let running=false;
let mode='down';
let v=BASE;
let targetV=BASE;
let lastT=performance.now();
let y=0;

function maxScroll(){
  return document.documentElement.scrollHeight - innerHeight;
}

// ★ 最後の本が「下に見える」位置
function lastVisibleY(){
  const r = lastMarker.getBoundingClientRect();
  const absY = window.scrollY + r.top;
  return Math.min(absY - innerHeight * 0.6, maxScroll());
}

function step(t){
  if(!running) return;
  const dt=(t-lastT)/1000; lastT=t;

  if(mode==='down' && y>=lastVisibleY()){
    mode='rewind';
    targetV = -BASE * REWIND_MULT;
    cycleEl.textContent='rewind';
  }
  if(mode==='rewind' && y<=EDGE){
    y=0;
    mode='down';
    targetV = BASE;
    cycleEl.textContent='down';
  }

  v += (targetV - v) * 0.06;
  y = Math.max(0, Math.min(maxScroll(), y + v*dt));
  scrollTo(0, Math.round(y));
  requestAnimationFrame(step);
}

toggleBtn.onclick=()=>{
  running=!running;
  stateEl.textContent = running?'on':'off';
  runStateEl.textContent = stateEl.textContent;
  if(running){
    y=scrollY;
    lastT=performance.now();
    requestAnimationFrame(step);
  }
};
</script>
</body>
</html>
