<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>timeline</title>

  <style>
    :root{
      --bg:#fff;
      --text: rgba(0,0,0,0.90);
      --muted: rgba(0,0,0,0.58);
      --rule: rgba(0,0,0,0.10);
    }
    html,body{ margin:0; background:var(--bg); color:var(--text); }
    body{
      font-family: system-ui, -apple-system, "Segoe UI",
                   "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo",
                   "Noto Sans JP", sans-serif;
      letter-spacing: 0.01em;
      line-height: 1.55;
    }

    main{
      max-width: 760px;
      margin: auto;
      padding: 44px 18px 96px;
    }

    h1{ font-size:16px; margin:0 0 14px; }
    h2{ font-size:13px; color:var(--muted); margin:22px 0 10px; }
    hr{ border:none; border-top:1px solid var(--rule); margin:16px 0; }
    ul{ margin:0 0 0 1.15em; padding:0; }
    li{ margin:6px 0; }

    .scroll-dummy{ height:1400px; }

    .fab{
      position:fixed; right:14px; bottom:14px;
      z-index:9999;
      display:flex; gap:10px; align-items:center;
      padding:10px 12px;
      border:1px solid rgba(0,0,0,0.12);
      border-radius:999px;
      background:rgba(255,255,255,0.92);
      font-size:12.5px;
    }
    .fab button{
      border:none; background:none; cursor:pointer;
      font:inherit;
    }

    .exp{
      position:fixed; top:12px; right:12px;
      z-index:9999;
      padding:10px 12px;
      border:1px solid rgba(0,0,0,0.12);
      border-radius:12px;
      background:rgba(255,255,255,0.92);
      font-size:12px;
      min-width:180px;
    }
  </style>
</head>

<body>
<main>
  <h1>年表（確認用）</h1>
  <hr>
  <h2>前8世紀頃</h2>
  <ul><li>イリアス</li><li>オデュッセイア</li></ul>
  <h2>2026</h2>
  <ul><li>物とは何か（原稿）</li></ul>
</main>

<div class="scroll-dummy"></div>

<div class="exp">
  <div>state: <span id="runstate">off</span></div>
  <div>y/max: <span id="pos">0</span>/<span id="max">0</span></div>
</div>

<div class="fab">
  <button id="toggle">walk</button>
  <span id="state">off</span>
</div>

<script>
/* ========= 基本状態 ========= */
let running = false;
let lastT = performance.now();
let ignoreStopUntil = 0;

const stateEl = document.getElementById('state');
const runStateEl = document.getElementById('runstate');
const posEl = document.getElementById('pos');
const maxEl = document.getElementById('max');
const toggleBtn = document.getElementById('toggle');

/* ========= util ========= */
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
const maxScrollTop = ()=>{
  const d=document.documentElement;
  return Math.max(0, d.scrollHeight - window.innerHeight);
};

/* ========= UI更新 ========= */
function updateDiag(){
  stateEl.textContent = running ? 'on' : 'off';
  runStateEl.textContent = running ? 'on' : 'off';
  posEl.textContent = Math.round(window.scrollY);
  maxEl.textContent = Math.round(maxScrollTop());
}
updateDiag();

/* ========= stop ========= */
function stop(){
  if (performance.now() < ignoreStopUntil) return;
  if (!running) return;
  running = false;
  updateDiag();
}

/* ========= step ========= */
function step(t){
  if (!running) return;

  const dt = (t - lastT) / 1000;
  lastT = t;

  const top = window.scrollY;
  const mx = maxScrollTop();
  if (top >= mx) { stop(); return; }

  window.scrollTo(0, clamp(top + 20*dt, 0, mx));
  requestAnimationFrame(step);
}

/* ========= toggle ========= */
function toggle(){
  running = !running;

  if (running) {
    ignoreStopUntil = performance.now() + 300;
    const y0 = window.scrollY;
    window.scrollTo(0, y0);
    lastT = performance.now();
    requestAnimationFrame(step);
  }

  updateDiag();
}

/* ========= events ========= */
toggleBtn.addEventListener('click', toggle);
window.addEventListener('wheel', stop, {passive:true});
window.addEventListener('keydown', stop);
window.addEventListener('mousedown', e=>{
  if (!e.target.closest('.fab')) stop();
});
</script>
</body>
</html>
